<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Viewer Dashboard</title>
  <style>
    body { font-family: Arial; background:#f6f9ff; margin:0; padding:16px; }
    .topbar { display:flex; gap:10px; align-items:center; }
    .topbar a, .topbar button { padding:8px 10px; border-radius:8px; border:0; cursor:pointer; background:#3b6dd8; color:#fff; text-decoration:none }
    .table-wrap { overflow:auto; border:1px solid #eee; border-radius:8px; background:#fff; margin-top:12px; }
    table { width:max-content; min-width:100%; border-collapse:collapse; font-size:13px; }
    th, td { border:1px solid #e6e6e6; padding:6px; white-space:nowrap; }
    th { background:#d0e2ff; }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="index.html">Home</a>
    <a href="supervisor.html">Supervisor</a>
    <a href="agronomist.html">Agronomist</a>
    <a href="farmreport.html">Farm Report</a>
    <button style="margin-left:auto" onclick="logout()">Logout</button>
  </div>

  <h1>Viewer Dashboard</h1>

  <div style="display:flex; gap:8px; align-items:center; margin-top:10px;">
    <input id="q" placeholder="Search...">
    <button onclick="search()">Search</button>
    <button onclick="clearSearch()">Clear</button>
  </div>

  <div class="table-wrap">
    <table id="tbl">
      <thead>
        <tr>
          <th>ID</th><th>Farm</th><th>GH</th><th>AREA</th><th>CROP</th><th>VARIETY</th><th>MODE</th><th>METHOD</th><th>TIME</th>
          <th>MON Rate</th><th>MON Vol(L)</th><th>MON Chemical</th><th>MON Area</th><th>MON Mode</th>
          <th>TUE Rate</th><th>TUE Vol(L)</th><th>TUE Chemical</th><th>TUE Area</th><th>TUE Mode</th>
          <th>WED Rate</th><th>WED Vol(L)</th><th>WED Chemical</th><th>WED Area</th><th>WED Mode</th>
          <th>THU Rate</th><th>THU Vol(L)</th><th>THU Chemical</th><th>THU Area</th><th>THU Mode</th>
          <th>FRI Rate</th><th>FRI Vol(L)</th><th>FRI Chemical</th><th>FRI Area</th><th>FRI Mode</th>
          <th>SAT Rate</th><th>SAT Vol(L)</th><th>SAT Chemical</th><th>SAT Area</th><th>SAT Mode</th>
          <th>SUN Rate</th><th>SUN Vol(L)</th><th>SUN Chemical</th><th>SUN Area</th><th>SUN Mode</th>
          <th>Target</th><th>Justification</th><th>Morning</th><th>Evening</th><th>Prepared By</th><th>Agronomist Remarks</th><th>Supervisor Remarks</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
async function load(){
  try{
    const res = await fetch('/agro', { credentials: 'same-origin' });
    if (!res.ok) { if (res.status===401) location.href='login.html'; return; }
    const rows = await res.json();
    const tb = document.querySelector('#tbl tbody');
    tb.innerHTML = rows.map(r => {
      const p = k => (r[k]||'');
      return `<tr>
        <td>${p('id')}</td><td>${p('farm')}</td><td>${p('gh')}</td><td>${p('area')}</td><td>${p('crop')}</td><td>${p('variety')}</td><td>${p('mode')}</td><td>${p('method')}</td><td>${p('time')}</td>

        <td>${p('mon_rate')}</td><td>${p('mon_vol')}</td><td>${p('mon_chemical')}</td><td>${p('mon_area')}</td><td>${p('mon_mode')}</td>
        <td>${p('tue_rate')}</td><td>${p('tue_vol')}</td><td>${p('tue_chemical')}</td><td>${p('tue_area')}</td><td>${p('tue_mode')}</td>
        <td>${p('wed_rate')}</td><td>${p('wed_vol')}</td><td>${p('wed_chemical')}</td><td>${p('wed_area')}</td><td>${p('wed_mode')}</td>
        <td>${p('thu_rate')}</td><td>${p('thu_vol')}</td><td>${p('thu_chemical')}</td><td>${p('thu_area')}</td><td>${p('thu_mode')}</td>
        <td>${p('fri_rate')}</td><td>${p('fri_vol')}</td><td>${p('fri_chemical')}</td><td>${p('fri_area')}</td><td>${p('fri_mode')}</td>
        <td>${p('sat_rate')}</td><td>${p('sat_vol')}</td><td>${p('sat_chemical')}</td><td>${p('sat_area')}</td><td>${p('sat_mode')}</td>
        <td>${p('sun_rate')}</td><td>${p('sun_vol')}</td><td>${p('sun_chemical')}</td><td>${p('sun_area')}</td><td>${p('sun_mode')}</td>

        <td>${p('target')}</td><td>${p('justification')}</td><td>${p('morning')}</td><td>${p('evening')}</td><td>${p('preparedBy')}</td><td>${p('agronomistRemarks')}</td><td>${p('supervisorRemarks')}</td>
      </tr>`;
    }).join('');
  }catch(err){ console.error(err); alert('Load failed'); }
}

function search(){
  const q = (document.getElementById('q').value || '').trim().toLowerCase();
  document.querySelectorAll('#tbl tbody tr').forEach(tr=>{
    tr.style.display = tr.innerText.toLowerCase().includes(q) ? '' : 'none';
  });
}
function clearSearch(){ document.getElementById('q').value=''; search(); }
async function logout(){ await fetch('/logout', { method:'POST', credentials:'same-origin' }); location.href='login.html'; }

load();
</script>
</body>
</html>
